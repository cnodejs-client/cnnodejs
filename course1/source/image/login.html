<div class="markdown-text"><blockquote> <p>微信应用号入门实践之cnode社区版</p> </blockquote> <p>首先感谢cnode社区提供的api，本次实现了简单的cnode社区应用号制作。 实现了数据的读取、展示， 实现了简单的布局， 实现了下一页功能。</p> <p>放上我的github地址 <a href="https://github.com/coolfishstudio/wechat-webapp-cnode">https://github.com/coolfishstudio/wechat-webapp-cnode</a></p> <p><img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/1.png" alt="首页列表"> <img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/2.png" alt="内容详情"></p> <p>下面就说说我做这个的过程，不足之处，请多多指教，只愿为进步。</p> <h2>1.创建项目</h2> <p>首先，在官网下载工具，<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/download.html?t=1474887501214">下载地址</a> 我的是选择mac版本0.9.092300。</p> <p>然后跟着官方的<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/?t=1474887501301">简版教程</a> 创建一个项目。</p> <h4>注：现在官方的工具支持无appid创建项目。</h4> <h5>1.打开开发者工具，选择“添加项目”</h5> <p><img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/3.png" alt></p> <h5>2.选择无appid，填写地址，创建项目</h5> <p><img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/4.png" alt></p> <h5>3.创建成功，看到默认的Demo项目页面</h5> <p><img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/5.png" alt></p> <h2>2.配置</h2> <p>默认的项目里已经没有关于tabBar的配置信息，所以为了学习，我把这个配置进行了修改。</p> <p>首先关于配置的说明同样来自于<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/config.html?t=1474887501556">官方</a></p> <p>注意：官方的代码有些字段是不一样的，小心被坑。</p> <pre class="prettyprint"><code>{ &quot;pages&quot;:[ &quot;pages&#x2F;index&#x2F;index&quot;, &quot;pages&#x2F;logs&#x2F;logs&quot; ], &quot;window&quot;:{ &quot;backgroundTextStyle&quot;:&quot;light&quot;, &quot;navigationBarBackgroundColor&quot;: &quot;#fff&quot;, &quot;navigationBarTitleText&quot;: &quot;WeChat&quot;, &quot;navigationBarTextStyle&quot;:&quot;black&quot; }, &quot;tabBar&quot;:{ &quot;list&quot;: [{ &quot;pagePath&quot;: &quot;pages&#x2F;index&#x2F;index&quot;, &quot;text&quot;: &quot;首页&quot; }, { &quot;pagePath&quot;: &quot;pages&#x2F;logs&#x2F;logs&quot;, &quot;text&quot;: &quot;日志&quot; }] } } </code></pre><p>增加了tabBar, 查看调试 <img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/6.png" alt> 看界面是如此的简陋，为此针对tabBar参考官方说明进行了简单的美化。</p> <pre class="prettyprint"><code> &quot;tabBar&quot;:{ &quot;color&quot;:&quot;#272636&quot;, &quot;selectedColor&quot;:&quot;#80bd01&quot;, &quot;backgroundColor&quot;:&quot;#fff&quot;, &quot;borderStyle&quot;:&quot;white&quot;, &quot;list&quot;:[{ &quot;pagePath&quot;:&quot;pages&#x2F;index&#x2F;index&quot;, &quot;text&quot;:&quot;首页&quot;, &quot;iconPath&quot;:&quot;images&#x2F;tabBar&#x2F;my.png&quot;, &quot;selectedIconPath&quot;:&quot;images&#x2F;tabBar&#x2F;my_hl.png&quot; },{ &quot;pagePath&quot;:&quot;pages&#x2F;index&#x2F;index&quot;, &quot;text&quot;:&quot;我的&quot;, &quot;iconPath&quot;:&quot;images&#x2F;tabBar&#x2F;list.png&quot;, &quot;selectedIconPath&quot;:&quot;images&#x2F;tabBar&#x2F;list_hl.png&quot; }] } </code></pre><p>效果如图 <img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/7.png" alt> 最后根据文档，对默认页面的窗口表现进行了修改</p> <pre class="prettyprint"><code> &quot;window&quot;:{ &quot;backgroundTextStyle&quot;:&quot;black&quot;, &quot;backgroundColor&quot;:&quot;#fff&quot;, &quot;navigationBarBackgroundColor&quot;:&quot;#000&quot;, &quot;navigationBarTitleText&quot;:&quot;CNODE 应用号版&quot;, &quot;navigationBarTextStyle&quot;:&quot;white&quot;, &quot;enablePullDownRefresh&quot;:&quot;true&quot; }, </code></pre><p>效果如图 <img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/8.png" alt> 整体配置文件为</p> <pre class="prettyprint"><code>{ &quot;pages&quot;:[ &quot;pages&#x2F;index&#x2F;index&quot;, &quot;pages&#x2F;logs&#x2F;logs&quot; ], &quot;window&quot;:{ &quot;backgroundTextStyle&quot;:&quot;black&quot;, &quot;backgroundColor&quot;:&quot;#fff&quot;, &quot;navigationBarBackgroundColor&quot;:&quot;#000&quot;, &quot;navigationBarTitleText&quot;:&quot;CNODE 应用号版&quot;, &quot;navigationBarTextStyle&quot;:&quot;white&quot;, &quot;enablePullDownRefresh&quot;:&quot;true&quot; }, &quot;tabBar&quot;:{ &quot;color&quot;:&quot;#272636&quot;, &quot;selectedColor&quot;:&quot;#80bd01&quot;, &quot;backgroundColor&quot;:&quot;#fff&quot;, &quot;borderStyle&quot;:&quot;white&quot;, &quot;list&quot;:[{ &quot;pagePath&quot;:&quot;pages&#x2F;index&#x2F;index&quot;, &quot;text&quot;:&quot;首页&quot;, &quot;iconPath&quot;:&quot;images&#x2F;tabBar&#x2F;my.png&quot;, &quot;selectedIconPath&quot;:&quot;images&#x2F;tabBar&#x2F;my_hl.png&quot; },{ &quot;pagePath&quot;:&quot;pages&#x2F;index&#x2F;index&quot;, &quot;text&quot;:&quot;我的&quot;, &quot;iconPath&quot;:&quot;images&#x2F;tabBar&#x2F;list.png&quot;, &quot;selectedIconPath&quot;:&quot;images&#x2F;tabBar&#x2F;list_hl.png&quot; }] } } </code></pre><h2>3.制作首页列表</h2> <p>根据官方要求，我在pages文件夹内创建了topics文件夹，并创建了对应了 topics.js、topics.wxml、topics.wxss 三个文件。</p> <h3>1.注册页面</h3> <p>首先在配置文件里注册这个topics,</p> <pre class="prettyprint"><code> &quot;pages&quot;:[ &quot;pages&#x2F;topics&#x2F;topics&quot;, &quot;pages&#x2F;index&#x2F;index&quot;, &quot;pages&#x2F;logs&#x2F;logs&quot; ], </code></pre><p>并且制定tabBar点击跳到对应的topics页面</p> <pre class="prettyprint"><code> &quot;tabBar&quot;:{ &quot;color&quot;:&quot;#272636&quot;, &quot;selectedColor&quot;:&quot;#80bd01&quot;, &quot;backgroundColor&quot;:&quot;#fff&quot;, &quot;borderStyle&quot;:&quot;white&quot;, &quot;list&quot;:[{ &quot;pagePath&quot;:&quot;pages&#x2F;topics&#x2F;topics&quot;, &quot;text&quot;:&quot;首页&quot;, &quot;iconPath&quot;:&quot;images&#x2F;tabBar&#x2F;my.png&quot;, &quot;selectedIconPath&quot;:&quot;images&#x2F;tabBar&#x2F;my_hl.png&quot; },{ &quot;pagePath&quot;:&quot;pages&#x2F;index&#x2F;index&quot;, &quot;text&quot;:&quot;我的&quot;, &quot;iconPath&quot;:&quot;images&#x2F;tabBar&#x2F;list.png&quot;, &quot;selectedIconPath&quot;:&quot;images&#x2F;tabBar&#x2F;list_hl.png&quot; }] } </code></pre><h5>注意：我发现注册页面的顺序会影响到默认显示tabBar的顺序，所以我把<code>&quot;pages/topics/topics&quot;</code>放到了<code>&quot;pages/index/index&quot;</code>的前面</h5> <p>然后编写topics.js</p> <pre class="prettyprint"><code>Page({ data: { title: &#x27;首页列表&#x27; }, onLoad: function () { console.log(&#x27;onLoad by topics&#x27;); } }); </code></pre><p>以及topics.wxml文件</p> <pre class="prettyprint"><code>&lt;view class=&quot;topics-main&quot;&gt; 测试首页列表界面 &lt;&#x2F;view&gt; </code></pre><p>和topics.wxss文件</p> <pre class="prettyprint"><code>.topics-main { background: #f60; height: 100%; } </code></pre><p>最后效果如图 <img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/9.png" alt></p> <h3>2.创建请求</h3> <p>根据文档<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/network-request.html?t=1474887499445">请求数据</a>，在util文件夹内创建一个api.js文件，专门进行数据请求处理。</p> <pre class="prettyprint"><code>&#x27;use strict&#x27;; var HOST_URI = &#x27;https:&#x2F;&#x2F;cnodejs.org&#x2F;api&#x2F;v1&#x27;; var GET_TOPICS = &#x27;&#x2F;topics&#x27;; var GET_TOPIC_BY_ID = &#x27;&#x2F;topic&#x2F;&#x27;; function obj2uri (obj) { return Object.keys(obj).map(function (k) { return encodeURIComponent(k) + &#x27;=&#x27; + encodeURIComponent(obj[k]); }).join(&#x27;&amp;&#x27;); } module.exports = { &#x2F;&#x2F; 获取列表数据 getTopics: function (obj) { return HOST_URI + GET_TOPICS + &#x27;?&#x27; + obj2uri(obj); }, &#x2F;&#x2F; 获取内容页数据 getTopicByID: function (id, obj) { return HOST_URI + GET_TOPIC_BY_ID + id + &#x27;?&#x27; + obj2uri(obj); } }; </code></pre><p>修改topics.js</p> <pre class="prettyprint"><code>var Api = require(&#x27;..&#x2F;..&#x2F;utils&#x2F;api.js&#x27;); Page({ data: { title: &#x27;首页列表&#x27; }, onLoad: function () { console.log(&#x27;onLoad by topics&#x27;); this.fetchData();&#x2F;&#x2F; 获取数据 }, fetchData: function (data) { &#x2F;&#x2F; 处理参数 if (!data) data = {}; if (!data.page) data.page = 1; wx.request({ url: Api.getTopics(data), success: function (res) { console.log(res); } }); } }); </code></pre><p>效果如图 <img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/10.png" alt> 成功拿到了数据。</p> <h3>3.完善首页列表</h3> <p>拿到了数据，也能修改界面，那么就直接完善这个首页吧</p> <p>代码就不放了，直接上图 <img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/11.png" alt> 我认为这里值得说的大概只有loading、循环、传参、下一页和页面跳转了。</p> <h4>1.loading</h4> <pre class="prettyprint"><code> &lt;loading hidden=&quot;{{hidden}}&quot;&gt; 加载中... &lt;&#x2F;loading&gt; </code></pre><p>在topics.wxml中写官方提供的loading组件，根据在topics.js中对hidden值的修改，来触发loading。</p> <h4>2.循环数据，展示列表</h4> <p>文档提供了<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/view/wxml/list.html?t=1474887501556">列表渲染</a></p> <p>通过<code>wx:for</code>实现列表的渲染。</p> <h5>注意: 默认数组的当前项的下标变量名默认为index，数组当前项的变量名默认为item。</h5> <pre class="prettyprint"><code>&lt;block wx:for=&quot;{{postsList}}&quot;&gt; &lt;view class=&quot;posts-item&quot; index=&quot;{{index}}&quot; id=&quot;{{item.id}}&quot; catchtap=&quot;redictDetail&quot;&gt; &lt;view class=&quot;author&quot;&gt; &lt;image class=&quot;author-avatar&quot; src=&quot;{{item.author.avatar_url}}&quot;&gt;&lt;&#x2F;image&gt; &lt;view class=&quot;author-name&quot;&gt;{{item.author.loginname}}&lt;&#x2F;view&gt; &lt;view class=&quot;posts-tag hot&quot; wx:if=&quot;{{item.top === true}}&quot;&gt;置顶&lt;&#x2F;view&gt; &lt;view class=&quot;posts-tag&quot; wx:if=&quot;{{item.good === true}}&quot;&gt;精华&lt;&#x2F;view&gt; &lt;view class=&quot;posts-last-reply&quot;&gt;{{item.last_reply_at}}&lt;&#x2F;view&gt; &lt;&#x2F;view&gt; &lt;view class=&quot;posts-title&quot;&gt;{{item.title}}&lt;&#x2F;view&gt; &lt;view class=&quot;bar-info&quot;&gt; &lt;view class=&quot;bar-info-item&quot;&gt; &lt;image class=&quot;bar-info-item-icon&quot; src=&quot;&#x2F;images&#x2F;icon&#x2F;reply.png&quot;&gt;&lt;&#x2F;image&gt; &lt;view class=&quot;bar-info-item-number&quot;&gt;{{item.reply_count}}&lt;&#x2F;view&gt; &lt;&#x2F;view&gt; &lt;view class=&quot;bar-info-item&quot;&gt; &lt;image class=&quot;bar-info-item-icon&quot; src=&quot;&#x2F;images&#x2F;icon&#x2F;visit.png&quot;&gt;&lt;&#x2F;image&gt; &lt;view class=&quot;bar-info-item-number&quot;&gt;{{item.visit_count}}&lt;&#x2F;view&gt; &lt;&#x2F;view&gt; &lt;&#x2F;view&gt; &lt;&#x2F;view&gt; &lt;&#x2F;block&gt; </code></pre><p>附上一个没有样式的列表展现 <img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/12.png" alt></p> <h4>3.传参，实现tab切换</h4> <p>根据cnode的api可以知道通过tab不同的值，获得到不同标签下的内容列表。</p> <p>所以 在页面的最上面 tab 栏中</p> <pre class="prettyprint"><code> &lt;view class=&quot;top-bar&quot;&gt; &lt;view class=&quot;top-bar-item&quot; id=&quot;all&quot; catchtap=&quot;onTapTag&quot;&gt;全部&lt;&#x2F;view&gt; &lt;view class=&quot;top-bar-item&quot; id=&quot;good&quot; catchtap=&quot;onTapTag&quot;&gt;精华&lt;&#x2F;view&gt; &lt;view class=&quot;top-bar-item&quot; id=&quot;share&quot; catchtap=&quot;onTapTag&quot;&gt;分享&lt;&#x2F;view&gt; &lt;view class=&quot;top-bar-item&quot; id=&quot;ask&quot; catchtap=&quot;onTapTag&quot;&gt;问答&lt;&#x2F;view&gt; &lt;view class=&quot;top-bar-item&quot; id=&quot;job&quot; catchtap=&quot;onTapTag&quot;&gt;招聘&lt;&#x2F;view&gt; &lt;&#x2F;view&gt; </code></pre><p>将id进行定义，通过获取id拿到对应的tab类型。</p> <p>其中<code>catchtap</code>是事件绑定。</p> <p>bind事件绑定不会阻止冒泡事件向上冒泡，catch事件绑定可以阻止冒泡事件向上冒泡。</p> <p>在topics.js获取</p> <pre class="prettyprint"><code> onTapTag: function (e) { var self = this; var tab = e.currentTarget.id; &#x2F;&#x2F; 这里就能获取到不同的tab值了 self.setData({ tab: tab }); if (tab !== &#x27;all&#x27;) { this.fetchData({tab: tab}); } else { this.fetchData(); } }, </code></pre><h4>4.下一页的实现</h4> <p>根据文档，组件的视图容器中有<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/component/scroll-view.html?t=1474887496374">scroll-view</a>这个可滚动视图区域。</p> <h5>注意：使用竖向滚动时，需要给&lt;scroll-view/&gt;一个固定高度。</h5> <pre class="prettyprint"><code>&lt;scroll-view class=&quot;posts-list&quot; style=&quot;height:100%&quot; scroll-y=&quot;true&quot; bindscrolltolower=&quot;lower&quot;&gt; &lt;block wx:for=&quot;{{postsList}}&quot;&gt; ... &lt;&#x2F;block&gt; &lt;&#x2F;scroll-view&gt; </code></pre><p>topics.js文件</p> <pre class="prettyprint"><code> lower: function (e) { var self = this; &#x2F;&#x2F; 修改当前页码 self.setData({ page: self.data.page + 1 }); &#x2F;&#x2F; 判断当前页的tab值 进行请求数据 if (self.data.tab !== &#x27;all&#x27;) { this.fetchData({tab: self.data.tab, page: self.data.page}); } else { this.fetchData({page: self.data.page}); } } </code></pre><h4>5.跳页的实现</h4> <p>在<code>posts-item</code>中已经进行了事件绑定。利用<code>wx.navigateTo</code>实现页面的跳转。</p> <h5>注意：一个应用同时只能打开5个页面，当已经打开了5个页面之后，wx.navigateTo不能正常打开新页面。</h5> <pre class="prettyprint"><code>redictDetail: function (e) { console.log(&#x27;我要看详情&#x27;); var id = e.currentTarget.id, url = &#x27;..&#x2F;detail&#x2F;detail?id=&#x27; + id; &#x2F;&#x2F; 这里的detail是需要创建对应的文件，以及页面注册的 wx.navigateTo({ url: url }) }, </code></pre><h3>4.实现详情页</h3> <p>同样的原理，创建detail文件，并注册，获取数据，并美化页面。 <img src="http://7xqxfk.com1.z0.glb.clouddn.com//xiaoyingyong/cnode/13.png" alt></p> <h3>5.总结</h3> <ul> <li>微信小应用页面的脚本逻辑在是在JsCore中运行，JsCore是一个没有窗口对象的环境，所以不能再脚本中使用window，也无法在脚本中操作组件</li> <li>同样不能用jquery</li> <li>也不能操作dom</li> <li>部分标签不支持，比如 h1-h6 会编译报错。</li> <li>暂时没找到解决富文本详情页显示的办法。</li> <li>整体下来，感觉开发简单，限制很多。</li> <li>写过react的看这个确实比较简单。</li> </ul> <p>放上我的github地址 <a href="https://github.com/coolfishstudio/wechat-webapp-cnode">https://github.com/coolfishstudio/wechat-webapp-cnode</a></p> <p>最后感谢：cnode社区和博卡君</p> <p>附上 博卡君的教程</p> <p><a href="https://my.oschina.net/wwnick/blog/750055">全球首个微信应用号开发教程！通宵吐血赶稿，每日更新！</a></p> <p><a href="https://my.oschina.net/wwnick/blog/750495">博卡君的应用号（小程序）开发教程首发第二弹！（0923）</a></p> <p><a href="https://my.oschina.net/wwnick/blog/750974">第三弹！全球首个微信应用号开发教程！通宵吐血赶稿，每日更新！</a></p> <p><a href="https://my.oschina.net/wwnick/blog/751826">第四弹！全球首个微信应用号开发教程！通宵吐血赶稿，每日更新！</a></p> <p><a href="https://my.oschina.net/wwnick/blog/752421">第五弹！全球首个微信应用号开发教程！通宵吐血赶稿，每日更新！</a></p> <p><a href="https://my.oschina.net/wwnick/blog/753597">第六弹！全球首个微信小程序（应用号）开发教程！通宵吐血赶稿！</a> －－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－ 总结一下我遇到的问题 1.页面没有注册 那么 template 模版无法传递数据 拿不到动态数据 但是能使用wxss 2.进度条注意右侧百分号 100%的时候 进度条缩短 3.轮播图加上属性vertical=“vertical/horizontal” 可以修改布局方向，文档没说 4.有关icon，文档提供默认的只有9个，实际目前测出有15个 success, info, warn, waiting, safe_success, safe_warn,success_circle, success_no_circle, waiting_circle, circle, download,info_circle, cancel, search, clear</p> </div>